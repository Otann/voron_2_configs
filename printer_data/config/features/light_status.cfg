[gcode_macro DEBUG_HELPER]
description: Debugging macto to output some useful stuff
gcode:
  _INITIALIZE_FROM_DETECTED_TOOL
  {% set tool_names = printer.toolchanger.tool_names %}
  {% for tool_name in tool_names %}
    {% set tool = printer[tool_name] %}
    _SET_TOOL_LED TN={tool.tool_number} LOC=nozzle RED=0 GREEN=0 BLUE=0 WHITE=0
    {% if tool.active %}
      M117 Tool {tool.name} is active
      _SET_TOOL_LED TN={tool.tool_number} LOC=body RED=0 GREEN=1 BLUE=0 WHITE=0      
    {% else %}
      M117 While the tool {tool.name} is inactive
      _SET_TOOL_LED TN={tool.tool_number} LOC=body RED=1 GREEN=0 BLUE=0 WHITE=0      
    {% endif %}  
  {% endfor %}  

[gcode_macro _SET_TOOL_LED]
description: Sets the correct led of the head to requested color
gcode:
  {% set tn = params.TN %}
  {% set R = params.RED %}
  {% set G = params.GREEN %}
  {% set B = params.BLUE %}
  {% set W = params.WHITE %}
  {% set location = params.LOC|default('all') %} # one of 'all', 'nozzle', 'body'

  {% if location == 'all' %}
  
    SET_LED LED=t{tn}_led RED={R} GREEN={G} BLUE={B} WHITE={W}
  
  {% elif location == 'body' %}
  
    {% if tn == '2' %}
      SET_LED LED=t{tn}_led RED={R} GREEN={G} BLUE={B} WHITE={W} INDEX=3
    {% else %}
      SET_LED LED=t{tn}_led RED={R} GREEN={G} BLUE={B} WHITE={W} INDEX=1
    {% endif %}
  
  {% elif location == 'nozzle' %}

    {% if tn == '2' %}
      SET_LED LED=t{tn}_led RED={R} GREEN={G} BLUE={B} WHITE={W} INDEX=1
      SET_LED LED=t{tn}_led RED={R} GREEN={G} BLUE={B} WHITE={W} INDEX=2
    {% else %}
      SET_LED LED=t{tn}_led RED={R} GREEN={G} BLUE={B} WHITE={W} INDEX=2
      SET_LED LED=t{tn}_led RED={R} GREEN={G} BLUE={B} WHITE={W} INDEX=3
    {% endif %}
  
  {% else %}
    M117 Unknown location
  {% endif %}
  
  
  